(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{176:function(e,t,a){e.exports=a(350)},350:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(4),o=a.n(r),c=a(52),l=a(24),i=a(150),u=(a(185),a(94)),m=function(e,t){return Object(u.a)({},e,{},t)},p={token:null,username:null,error:null,loading:!1},h=function(e,t){return m(e,{error:null,loading:!0})},d=function(e,t){return m(e,{token:t.token,username:t.username,error:null,loading:!1})},f=function(e,t){return m(e,{error:t.error,loading:!1})},g=function(e,t){return m(e,{token:null})},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"AUTH_START":return h(e);case"AUTH_SUCCESS":return d(e,t);case"AUTH_FAIL":return f(e,t);case"AUTH_LOGOUT":return g(e);default:return e}},v={showAddChatPopup:!1},b=function(e,t){return m(e,{showAddChatPopup:!0})},k=function(e,t){return m(e,{showAddChatPopup:!1})},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"OPEN_AND_CHAT_POPUP":return b(e);case"CLOSE_ADD_CHAT_POPUP":return k(e);default:return e}},w=a(93),S={messages:[],chats:[]},O=function(e,t){return m(e,{messages:[].concat(Object(w.a)(e.messages),[t.message])})},C=function(e,t){return m(e,{messages:t.messages.reverse()})},A=function(e,t){return m(e,{chats:t.chats})},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_MESSAGE":return O(e,t);case"SET_MESSAGES":return C(e,t);case"GET_CHATS_SUCCESS":return A(e,t);default:return e}},j=a(15),D=a(65),N=a(10),_=a(25),P=a(26),I=a(47),M=a(44),U=function(e){return e.children},F=function(){function e(){Object(j.a)(this,e),this.callbacks={},this.socketRef=null}return Object(N.a)(e,null,[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),Object(N.a)(e,[{key:"connect",value:function(e){var t=this,a="ws://127.0.0.1:8000/ws/chat/".concat(e,"/");console.log(a),this.socketRef=new WebSocket(a),this.socketRef.onopen=function(){console.log("websocket open")},this.socketRef.onmessage=function(e){t.socketNewMessage(e.data)},this.socketRef.onerror=function(e){console.log(e.message)},this.socketRef.onclose=function(){console.log("websocket is closed"),t.connect()}}},{key:"disconnect",value:function(){this.socketRef.close()}},{key:"socketNewMessage",value:function(e){var t=JSON.parse(e),a=t.command;0!==Object.keys(this.callbacks).length&&("messages"===a&&this.callbacks[a](t.messages),console.log(this),"new_message"===a&&this.callbacks[a](t.message),console.log(this))}},{key:"fetchMessages",value:function(e,t){this.sendMessage({command:"fetch_messages",username:e,chatId:t}),console.log(t),console.log(e)}},{key:"newChatMessage",value:function(e){this.sendMessage({command:"new_message",from:e.from,message:e.content,chatId:e.chatId}),console.log(e)}},{key:"addCallbacks",value:function(e,t){this.callbacks.messages=e,this.callbacks.new_message=t}},{key:"sendMessage",value:function(e){try{this.socketRef.send(JSON.stringify(Object(u.a)({},e)))}catch(t){console.log(t.message)}}},{key:"state",value:function(){return this.socketRef.readyState}}]),e}();F.instance=null;var H=F.getInstance(),R=function(e){Object(P.a)(a,e);var t=Object(_.a)(a);function a(e){var n;return Object(j.a)(this,a),(n=t.call(this,e)).state={messages:[]},n.messageChangeHandler=function(e){n.setState({message:e.target.value})},n.sendMessageHandler=function(e){e.preventDefault();var t={from:n.props.username,content:n.state.message,chatId:n.props.match.params.chatID};H.newChatMessage(t),n.setState({message:[]})},n.renderTimestamp=function(e){var t=Math.round(((new Date).getTime()-new Date(e).getTime())/6e4);return t<1?"just now...":t<60&&t>1?"".concat(t," minutes ago"):t<1440&&t>60?"".concat(Math.round(t/60)," hours ago"):t<44640&&t>1440?"".concat(Math.round(t/1440)," days ago"):"".concat(new Date(e))},n.renderMessages=function(e){var t=n.props.username;return e.map((function(e,a,r){return s.a.createElement("li",{key:e.id,style:{marginBottom:r.length-1===a?"300px":"15px"},className:e.author===t?"replies":"sent"},s.a.createElement("img",{src:"http://emilcarlsson.se/assets/mikeross.png"}),s.a.createElement("p",null,e.content,s.a.createElement("br",null),s.a.createElement("small",null,n.renderTimestamp(e.timestamp))))}))},n.scrollToBottom=function(){n.messagesEnd.scrollIntoView({behavior:"smooth"})},n.initialiseChat(),n}return Object(N.a)(a,[{key:"initialiseChat",value:function(){var e=this;this.waitForSocketConnection((function(){H.fetchMessages(e.props.username,e.props.match.params.chatID)})),H.connect(this.props.match.params.chatID)}}]),Object(N.a)(a,[{key:"componentWillReceiveProps",value:function(e){var t=this;console.log(e),this.props.match.params.chatID!==e.match.params.chatID&&(H.disconnect(),this.waitForSocketConnection((function(){H.fetchMessages(t.props.username,e.match.params.chatID)})),H.connect(e.match.params.chatID))}},{key:"waitForSocketConnection",value:function(e){var t=this;setTimeout((function(){if(1===H.state())return console.log("connection is secure"),void e();console.log("waiting for connection..."),t.waitForSocketConnection(e)}),100)}},{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e=this;this.state.messages;return s.a.createElement("div",null,s.a.createElement("div",{className:"messages"},s.a.createElement("ul",{id:"chat-log"},this.props.messages&&this.renderMessages(this.props.messages),s.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}}))),s.a.createElement("div",{className:"message-input"},s.a.createElement("form",{onSubmit:this.sendMessageHandler},s.a.createElement("div",{className:"wrap"},s.a.createElement("input",{onChange:this.messageChangeHandler,value:this.state.message||"",required:!0,id:"chat-message-input",type:"text",placeholder:"Write your message..."}),s.a.createElement("i",{className:"fa fa-paperclip attachment","aria-hidden":"true"}),s.a.createElement("button",{id:"chat-message-submit",className:"submit"},s.a.createElement("i",{className:"fa fa-paper-plane","aria-hidden":"true"}))))))}}]),a}(s.a.Component),x=Object(l.b)((function(e){return{username:e.auth.username,messages:e.message.messages}}))(R),L=function(){return s.a.createElement(U,null,s.a.createElement(M.b,{exact:!0,path:"/:chatID/",component:x}))},G=a(353),B=a(354),J=a(36),V=a.n(J),z=function(e,t){return{type:"AUTH_SUCCESS",token:t,username:e}},W=function(e){return{type:"AUTH_FAIL",error:e}},q=function(){return localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("expirationDate"),{type:"AUTH_LOGOUT"}},X=function(e){return function(t){setTimeout((function(){t(q())}),1e3*e)}},K=function(e,t){return function(a){V.a.defaults.headers={"Content-Type":"application/json",Authorization:"Token ".concat(t)},V.a.get("http://127.0.0.1:8000/chat/?username=".concat(e)).then((function(e){return a({type:"GET_CHATS_SUCCESS",chats:e.data})}))}},Q=function(e){return s.a.createElement(I.b,{to:"".concat(e.chatURL),style:{color:"#fff"}},s.a.createElement("li",{className:"contact"},s.a.createElement("div",{className:"wrap"},s.a.createElement("span",{className:"contact-status online"}),s.a.createElement("img",{src:e.picURL,alt:""}),s.a.createElement("div",{className:"meta"},s.a.createElement("p",{className:"name"},e.name)))))},Y=s.a.createElement(G.a,{type:"loading",style:{fontSize:24},spin:!0}),Z=function(e){Object(P.a)(a,e);var t=Object(_.a)(a);function a(){var e;Object(j.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).state={loginForm:!0},e.changeForm=function(){e.setState({loginForm:!e.state.loginForm})},e.authenticate=function(t){t.preventDefault(),e.state.loginForm?(e.props.login(t.target.username.value,t.target.password.value),console.log(t.target.username.value),console.log(t.target.password.value)):e.props.signup(t.target.username.value,t.target.email.value,t.target.password.value,t.target.password2.value)},e}return Object(N.a)(a,[{key:"waitForAuthDetails",value:function(){var e=this;setTimeout((function(){null===e.props.token||void 0===e.props.token?(console.log("waiting for authentication details..."),e.waitForAuthDetails()):e.props.getUserChats(e.props.username,e.props.token)}),100)}},{key:"componentDidMount",value:function(){this.waitForAuthDetails()}},{key:"openAddChatPopup",value:function(){this.props.addChat()}},{key:"render",value:function(){var e=this,t=this.props.chats.map((function(e){return s.a.createElement(Q,{key:e.id,name:"Harvey Specter",picURL:"http://emilcarlsson.se/assets/louislitt.png",status:"busy",chatURL:"/".concat(e.id)})}));return s.a.createElement("div",{id:"sidepanel"},s.a.createElement("div",{id:"profile"},s.a.createElement("div",{className:"wrap"},s.a.createElement("img",{id:"profile-img",src:"http://emilcarlsson.se/assets/mikeross.png",className:"online",alt:""}),s.a.createElement("p",null,"Mike Ross"),s.a.createElement("i",{className:"fa fa-chevron-down expand-button","aria-hidden":"true"}),s.a.createElement("div",{id:"status-options"},s.a.createElement("ul",null,s.a.createElement("li",{id:"status-online",className:"active"},s.a.createElement("span",{className:"status-circle"})," ",s.a.createElement("p",null,"Online")),s.a.createElement("li",{id:"status-away"},s.a.createElement("span",{className:"status-circle"})," ",s.a.createElement("p",null,"Away")),s.a.createElement("li",{id:"status-busy"},s.a.createElement("span",{className:"status-circle"})," ",s.a.createElement("p",null,"Busy")),s.a.createElement("li",{id:"status-offline"},s.a.createElement("span",{className:"status-circle"})," ",s.a.createElement("p",null,"Offline")))),s.a.createElement("div",{id:"expanded"},this.props.loading?s.a.createElement(B.a,{indicator:Y}):this.props.isAuthenticated?s.a.createElement("button",{onClick:function(){return e.props.logout()},className:"authBtn"},s.a.createElement("span",null,"Logout")):s.a.createElement("div",null,s.a.createElement("form",{method:"POST",onSubmit:this.authenticate},this.state.loginForm?s.a.createElement("div",null,s.a.createElement("input",{name:"username",type:"text",placeholder:"username"}),s.a.createElement("input",{name:"password",type:"password",placeholder:"password"})):s.a.createElement("div",null,s.a.createElement("input",{name:"username",type:"text",placeholder:"username"}),s.a.createElement("input",{name:"email",type:"email",placeholder:"email"}),s.a.createElement("input",{name:"password",type:"password",placeholder:"password"}),s.a.createElement("input",{name:"password2",type:"password",placeholder:"password confirm"})),s.a.createElement("button",{type:"submit"},"Authenticate")),s.a.createElement("button",{onClick:this.changeForm},"Switch"))))),s.a.createElement("div",{id:"search"},s.a.createElement("label",{htmlFor:""},s.a.createElement("i",{className:"fa fa-search","aria-hidden":"true"})),s.a.createElement("input",{type:"text",placeholder:"Search contacts..."})),s.a.createElement("div",{id:"contacts"},s.a.createElement("ul",null,t)),s.a.createElement("div",{id:"bottom-bar"},s.a.createElement("button",{id:"addcontact",onClick:function(){return e.openAddChatPopup()}},s.a.createElement("i",{className:"fa fa-user-plus fa-fw","aria-hidden":"true"}),s.a.createElement("span",null,"Add Chat")),s.a.createElement("button",{id:"settings"},s.a.createElement("i",{className:"fa fa-cog fa-fw","aria-hidden":"true"}),s.a.createElement("span",null,"Settings"))))}}]),a}(s.a.Component),$=Object(l.b)((function(e){return{isAuthenticated:null!==e.auth.token,loading:e.auth.loading,token:e.auth.token,username:e.auth.username,chats:e.message.chats}}),(function(e){return{login:function(t,a){return e(function(e,t){return function(a){a({type:"AUTH_START"}),V.a.post("http://127.0.0.1:8000/rest-auth/login/",{username:e,password:t}).then((function(t){var n=t.data.key,s=new Date((new Date).getTime()+36e5);localStorage.setItem("token",n),localStorage.setItem("username",e),localStorage.setItem("expirationDate",s),a(z(e,n)),a(X(3600))})).catch((function(e){a(W(e))}))}}(t,a))},logout:function(){return e(q())},signup:function(t,a,n,s){return e(function(e,t,a,n){return function(s){s({type:"AUTH_START"}),V.a.post("http://127.0.0.1:8000/rest-auth/registration/",{username:e,email:t,password1:a,password2:n}).then((function(t){var a=t.data.key,n=new Date((new Date).getTime()+36e5);localStorage.setItem("token",a),localStorage.setItem("username",e),localStorage.setItem("expirationDate",n),s(z(e,a)),s(X(3600))})).catch((function(e){s(W(e))}))}}(t,a,n,s))},addChat:function(){return e({type:"OPEN_AND_CHAT_POPUP"})},getUserChats:function(t,a){return e(K(t,a))}}}))(Z),ee=function(e){Object(P.a)(a,e);var t=Object(_.a)(a);function a(){return Object(j.a)(this,a),t.apply(this,arguments)}return Object(N.a)(a,[{key:"render",value:function(){return null===this.props.token?s.a.createElement(M.a,{to:"/"}):s.a.createElement("div",{className:"contact-profile"},null!==this.props.username?s.a.createElement(U,null,s.a.createElement("img",{src:"http://emilcarlsson.se/assets/harveyspecter.png",alt:""}),s.a.createElement("p",null,this.props.username),s.a.createElement("div",{className:"social-media"},s.a.createElement("i",{className:"fa fa-facebook","aria-hidden":"true"}),s.a.createElement("i",{className:"fa fa-twitter","aria-hidden":"true"}),s.a.createElement("i",{className:"fa fa-instagram","aria-hidden":"true"}))):null)}}]),a}(s.a.Component),te=Object(l.b)((function(e){return{username:e.auth.username,token:e.auth.token}}))(ee),ae=a(356),ne=a(357),se=a(69),re=a(355),oe=re.a.Item;var ce=function(e){Object(P.a)(a,e);var t=Object(_.a)(a);function a(){var e;Object(j.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).state={usernames:[],error:null},e.handleChange=function(t){e.setState({usernames:t})},e.handleSubmit=function(t){var a=e.state.usernames;t.preventDefault(),e.props.form.validateFields((function(t,n){if(!t){var s=[].concat(Object(w.a)(a),[e.props.username]);console.log(s),V.a.defaults.headers={"Content-Type":"application/json",Authorization:"Token ".concat(e.props.token)},V.a.post("http://127.0.0.1:8000/chat/create/",{messages:[],participants:s}).then((function(t){e.props.history.push("/".concat(t.data.id)),e.props.closeAddChatPopup(),e.props.getUserChats(e.props.username,e.props.token)})).catch((function(t){console.error(t),e.setState({error:t})}))}}))},e}return Object(N.a)(a,[{key:"componentDidMount",value:function(){this.props.form.validateFields()}},{key:"render",value:function(){var e,t=this.props.form,a=t.getFieldDecorator,n=t.getFieldsError,r=t.getFieldError,o=(0,t.isFieldTouched)("userName")&&r("userName");return s.a.createElement(re.a,{layout:"inline",onSubmit:this.handleSubmit},this.state.error?"".concat(this.state.error):null,s.a.createElement(oe,{validateStatus:o?"error":"",help:o||""},a("userName",{rules:[{required:!0,message:"Please input the username of the person you want to chat with"}]})(s.a.createElement(ne.a,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",onChange:this.handleChange},[]))),s.a.createElement(oe,null,s.a.createElement(se.a,{type:"primary",htmlType:"submit",disabled:(e=n(),Object.keys(e).some((function(t){return e[t]})))},"Start a chat")))}}]),a}(s.a.Component),le=re.a.create()(ce),ie=Object(M.f)(Object(l.b)((function(e){return{token:e.auth.token,username:e.auth.username}}),(function(e){return{closeAddChatPopup:function(){return e({type:"CLOSE_ADD_CHAT_POPUP"})},getUserChats:function(t,a){return e(K(t,a))}}}))(le)),ue=function(e){Object(P.a)(a,e);var t=Object(_.a)(a);function a(){return Object(j.a)(this,a),t.apply(this,arguments)}return Object(N.a)(a,[{key:"render",value:function(){return console.log("Testing....."),s.a.createElement(ae.a,{centered:!0,footer:null,visible:this.props.isVisible,onCancel:this.props.close},s.a.createElement(ie,null))}}]),a}(s.a.Component),me=function(e){Object(P.a)(a,e);var t=Object(_.a)(a);function a(e){var n;return Object(j.a)(this,a),n=t.call(this,e),H.addCallbacks(n.props.setMessages.bind(Object(D.a)(n)),n.props.addMessage.bind(Object(D.a)(n))),n}return Object(N.a)(a,[{key:"componentDidMount",value:function(){this.props.onTryAutoSignup()}}]),Object(N.a)(a,[{key:"render",value:function(){var e=this;return s.a.createElement(I.a,null,s.a.createElement("div",{id:"frame"},s.a.createElement($,null),s.a.createElement("div",{className:"content"},s.a.createElement(ue,{isVisible:this.props.showAddChatPopup,close:function(){return e.props.closeAddChatPopup()}}),s.a.createElement(te,null),s.a.createElement(L,null))))}}]),a}(s.a.Component),pe=Object(l.b)((function(e){return{showAddChatPopup:e.nav.showAddChatPopup,authenticated:e.auth.token}}),(function(e){return{onTryAutoSignup:function(){return e((function(e){var t=localStorage.getItem("token"),a=localStorage.getItem("username");if(void 0===t)e(q());else{var n=new Date(localStorage.getItem("expirationDate"));n<=new Date?e(q()):(e(z(a,t)),e(X((n.getTime()-(new Date).getTime())/1e3)))}}))},closeAddChatPopup:function(){return e({type:"CLOSE_ADD_CHAT_POPUP"})},addMessage:function(t){return e(function(e){return{type:"ADD_MESSAGE",message:e}}(t))},setMessages:function(t){return e(function(e){return{type:"SET_MESSAGES",messages:e}}(t))}}}))(me),he=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||c.d;var de=function(){var e=Object(c.c)({auth:E,nav:y,message:T});return Object(c.e)(e,he(Object(c.a)(i.a)))}(),fe=s.a.createElement(l.a,{store:de},s.a.createElement(pe,null));o.a.render(fe,document.getElementById("app"))}},[[176,1,2]]]);
//# sourceMappingURL=main.1ed9b9a8.chunk.js.map